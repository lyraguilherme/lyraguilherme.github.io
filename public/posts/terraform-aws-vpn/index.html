<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Automating AWS site-to-site VPNs with Terraform | Guilherme Lyra</title>
<meta name="keywords" content="">
<meta name="description" content="Introduction In this post, I&rsquo;ll walk you through how to use Terraform to set up a VPN site-to-site connection on AWS, leveraging Infrastructure as Code (IaC) to make the process quicker, easier, and fully repeatable.
For the examples below, we’ll build a cloud infrastructure using a Virtual Private Gateway (VGW). In a future post, we’ll explore using a Transit Gateway (TGW) for more complex setups.
I’m running everything on a MacBook, but you can easily replicate these steps on a Linux jump host or any similar environment.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/terraform-aws-vpn/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/terraform-aws-vpn/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Guilherme Lyra (Alt + H)">Guilherme Lyra</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                    <li>
                        <a href="http://localhost:1313/pt-br/" title="Português"
                            aria-label="Português">Pt-Br</a>
                    </li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives/" title="All posts">
                    <span>All posts</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Automating AWS site-to-site VPNs with Terraform
    </h1>
    <div class="post-meta"><span title='2024-10-06 18:00:00 -0300 -03'>October 6, 2024</span>

</div>
  </header> 
<figure class="entry-cover"><img loading="eager" src="http://localhost:1313/images/terraform-aws-vpn/awsterraform1.png" alt="Automating AWS site-to-site VPNs with Terraform">
        <p>Automating AWS site-to-site VPNs with Terraform</p>
</figure><div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#preparation" aria-label="Preparation">Preparation</a><ul>
                        
                <li>
                    <a href="#aws-identity-and-access-management-iam" aria-label="AWS Identity and Access Management (IAM)">AWS Identity and Access Management (IAM)</a></li>
                <li>
                    <a href="#installing-aws-cli" aria-label="Installing AWS CLI">Installing AWS CLI</a></li>
                <li>
                    <a href="#setting-up-aws-cli-profiles" aria-label="Setting up AWS CLI profiles">Setting up AWS CLI profiles</a></li></ul>
                </li>
                <li>
                    <a href="#diving-into-automation" aria-label="Diving into Automation">Diving into Automation</a><ul>
                        
                <li>
                    <a href="#terraform-configuration" aria-label="Terraform configuration">Terraform configuration</a></li>
                <li>
                    <a href="#initializing-the-terraform-configuration" aria-label="Initializing the Terraform Configuration">Initializing the Terraform Configuration</a></li>
                <li>
                    <a href="#planning-the-changes" aria-label="Planning the changes">Planning the changes</a></li>
                <li>
                    <a href="#applying-the-changes" aria-label="Applying the changes">Applying the changes</a></li>
                <li>
                    <a href="#viewing-terraform-outputs" aria-label="Viewing Terraform Outputs">Viewing Terraform Outputs</a></li>
                <li>
                    <a href="#terraform-destroy" aria-label="Terraform Destroy">Terraform Destroy</a></li></ul>
                </li>
                <li>
                    <a href="#configuring-an-on-prem-cisco-router" aria-label="Configuring an on-prem Cisco Router">Configuring an on-prem Cisco Router</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h1>
<p>In this post, I&rsquo;ll walk you through how to use Terraform to set up a VPN site-to-site connection on AWS, leveraging Infrastructure as Code (IaC) to make the process quicker, easier, and fully repeatable.</p>
<p>For the examples below, we’ll build a cloud infrastructure using a Virtual Private Gateway (VGW). In a future post, we’ll explore using a Transit Gateway (TGW) for more complex setups.</p>
<p>I’m running everything on a MacBook, but you can easily replicate these steps on a Linux jump host or any similar environment.</p>
<h1 id="preparation">Preparation<a hidden class="anchor" aria-hidden="true" href="#preparation">#</a></h1>
<h2 id="aws-identity-and-access-management-iam">AWS Identity and Access Management (IAM)<a hidden class="anchor" aria-hidden="true" href="#aws-identity-and-access-management-iam">#</a></h2>
<p>If you don&rsquo;t have one yet, the first step is to create an Access Key. This will allow you to authenticate and interact with AWS services through the CLI.</p>
<p>For this example, we’ll create a restrictive policy that only grants access to the specific resources needed, following the principle of least privilege.</p>
<ol>
<li>Access the AWS console and go to IAM.</li>
<li>Under Access Management, go to Policies and click Create Policy.</li>
<li>I named my policy <code>custom_policy_vpn_only</code></li>
<li>In the policy editor, select JSON and copy/paste the JSON below:</li>
</ol>
<pre tabindex="0"><code>{
    &#34;Version&#34;: &#34;2012-10-17&#34;,
    &#34;Statement&#34;: [
        {
            &#34;Effect&#34;: &#34;Allow&#34;,
            &#34;Action&#34;: [
                &#34;ec2:CreateVpnGateway&#34;,
                &#34;ec2:CreateCustomerGateway&#34;,
                &#34;ec2:CreateVpnConnection&#34;,
                &#34;ec2:CreateVpnConnectionRoute&#34;,
                &#34;ec2:DeleteVpnGateway&#34;,
                &#34;ec2:DeleteCustomerGateway&#34;,
                &#34;ec2:DeleteVpnConnection&#34;,
                &#34;ec2:DeleteVpnConnectionRoute&#34;,
                &#34;ec2:DescribeVpnGateways&#34;,
                &#34;ec2:DescribeCustomerGateways&#34;,
                &#34;ec2:DescribeVpnConnections&#34;,
                &#34;ec2:AttachVpnGateway&#34;,
                &#34;ec2:DetachVpnGateway&#34;,
                &#34;ec2:CreateTags&#34;
            ],
            &#34;Resource&#34;: &#34;*&#34;
        }
    ]
}
</code></pre><ol start="4">
<li>Go back to the Access management menu, go to <em><strong>Users</strong></em> and click <em><strong>Create user</strong></em></li>
<li>Define the username as you wish. I created a user named &ldquo;networkops&rdquo;&quot;</li>
<li>On Set permissions, select Attach policies directly and select the policy we created before (use the search to make it easier to find the desired policy)</li>
<li>Once the user is created, click on the username and on the Summary page, click &ldquo;Create access key&rdquo;</li>
<li>For the Use case, select &ldquo;Other&rdquo;</li>
</ol>
<p>Save your access key and secret access key</p>
<h2 id="installing-aws-cli">Installing AWS CLI<a hidden class="anchor" aria-hidden="true" href="#installing-aws-cli">#</a></h2>
<p>The first step is to install AWS CLI.</p>
<p>The procedure described below is available here: <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">AWS Docs</a></p>
<p>Download the file using the curl command. The -o option specifies the file name that the downloaded package is written to.
In this example, the file is written to <code>AWSCLIV2.pkg</code> in the current folder.</p>
<pre tabindex="0"><code>curl &#34;https://awscli.amazonaws.com/AWSCLIV2.pkg&#34; -o &#34;AWSCLIV2.pkg&#34;
</code></pre><p>Run the standard macOS installer program, specifying the downloaded .pkg file as the source. Use the -pkg parameter to specify the name of the package to install, and the -target / parameter for which drive to install the package to. The files are installed to /usr/local/aws-cli, and a symlink is automatically created in /usr/local/bin. You must include sudo on the command to grant write permissions to those folders.</p>
<pre tabindex="0"><code>sudo installer -pkg ./AWSCLIV2.pkg -target /
</code></pre><p>To verify that the shell can find and run the aws command in your $PATH, use the following commands:</p>
<pre tabindex="0"><code>which aws
</code></pre><pre tabindex="0"><code>aws --version
</code></pre><h2 id="setting-up-aws-cli-profiles">Setting up AWS CLI profiles<a hidden class="anchor" aria-hidden="true" href="#setting-up-aws-cli-profiles">#</a></h2>
<p>Using AWS CLI profiles allows us to easily manage multiple sets of credentials, improving security and simplifying access to different AWS accounts and regions. This makes automating workflows and switching contexts more efficient and secure.</p>
<p>In this example we&rsquo;re going to set up a profile called <em><strong>terraform-vpn</strong></em>, for lab purposes only.</p>
<p>Creating the profile:</p>
<pre tabindex="0"><code>aws configure --profile terraform-vpn
</code></pre><p>You will be prompted to enter your AWS credentials and configuration settings:</p>
<pre tabindex="0"><code>AWS Access Key ID [None]: &lt;your access key id&gt;
AWS Secret Access Key [None]: &lt;your access key id&gt;
Default region name [None]: &lt;your aws region&gt;
Default output format [None]: &lt;I suggest using JSON as the output format&gt;
</code></pre><p>Verify that the configuration was successful:</p>
<pre tabindex="0"><code>aws sts get-caller-identity --profile terraform-vpn
</code></pre><p>This command should return information about your AWS account, confirming that your credentials are working correctly.</p>
<h1 id="diving-into-automation">Diving into Automation<a hidden class="anchor" aria-hidden="true" href="#diving-into-automation">#</a></h1>
<h2 id="terraform-configuration">Terraform configuration<a hidden class="anchor" aria-hidden="true" href="#terraform-configuration">#</a></h2>
<p>I&rsquo;m considering you already have Terraform installed. If you don&rsquo;t, the process is quite simple and there&rsquo;s a ton of content on the Internet on how to do it.</p>
<p>First, we&rsquo;re going to create a <code>main.cf</code> file:</p>
<pre tabindex="0"><code>terraform {
  required_version = &#34;&gt;= 0.12&#34;
  required_providers {
    aws = {
      source  = &#34;hashicorp/aws&#34;
      version = &#34;~&gt; 3.0&#34;
    }
  }
}

provider &#34;aws&#34; {
  region  = var.aws_region
  profile = var.aws_profile
}

# Create a Virtual Private Gateway (VGW)
resource &#34;aws_vpn_gateway&#34; &#34;vgw&#34; {
  vpc_id = var.vpc_id
  tags = {
    Name = var.vgw_name_tag
  }
}

# Create a Customer Gateway (CGW)
resource &#34;aws_customer_gateway&#34; &#34;cgw&#34; {
  bgp_asn    = var.bgp_asn
  ip_address = var.vpn_peer_ip
  type       = &#34;ipsec.1&#34;
  tags = {
    Name = var.cgw_name_tag
  }
}

# Create a VPN Connection with BGP (dynamic routing)
resource &#34;aws_vpn_connection&#34; &#34;vpn_connection&#34; {
  customer_gateway_id = aws_customer_gateway.cgw.id
  vpn_gateway_id      = aws_vpn_gateway.vgw.id
  type                = &#34;ipsec.1&#34;

# BGP will be used so this must be set to false, or removed from the project
# If you&#39;re using static routes, set this to true
  static_routes_only = false

  tags = {
    Name = var.vpn_connection_name_tag
  }
}
</code></pre><p>Now that we have a main.tf, we need to create two more files:</p>
<p><code>variables.tf</code></p>
<pre tabindex="0"><code>variable &#34;aws_profile&#34; {
  description = &#34;AWS CLI profile to use&#34;
  type        = string
}

variable &#34;aws_region&#34; {
  description = &#34;AWS CLI profile to use&#34;
  type        = string
}

variable &#34;vpc_id&#34; {
  description = &#34;AWS region to use&#34;
  type        = string
}

variable &#34;vpn_peer_ip&#34; {
  description = &#34;Public IP address of the on-premises VPN peer&#34;
  type        = string
}

variable &#34;bgp_asn&#34; {
  description = &#34;BGP Autonomous System Number for the Customer Gateway&#34;
  type        = number
}

variable &#34;vgw_name_tag&#34; {
  description = &#34;Name tag for the Virtual Private Gateway&#34;
  type        = string
}

variable &#34;cgw_name_tag&#34; {
  description = &#34;Name tag for the Customer Gateway&#34;
  type        = string
}

variable &#34;vpn_connection_name_tag&#34; {
  description = &#34;Name tag for the VPN Connection&#34;
  type        = string
}
</code></pre><p>And, lastly, our <code>outputs.tf</code> file.</p>
<pre tabindex="0"><code>output &#34;vpn_connection_id&#34; {
  description = &#34;VPN ID&#34;
  value       = aws_vpn_connection.vpn_connection.id
}

output &#34;tunnel1_inside_cidr&#34; {
  description = &#34;Inside CIDR block for tunnel 1&#34;
  value       = aws_vpn_connection.vpn_connection.tunnel1_inside_cidr
}

output &#34;tunnel1_aws_bgp_ip&#34; {
  description = &#34;AWS BGP peer IP for tunnel 1&#34;
  value       = aws_vpn_connection.vpn_connection.tunnel1_vgw_inside_address
}

output &#34;tunnel1_customer_bgp_ip&#34; {
  description = &#34;Customer gateway BGP peer IP for tunnel 1&#34;
  value       = aws_vpn_connection.vpn_connection.tunnel1_cgw_inside_address
}

output &#34;tunnel1_aws_public_ip&#34; {
  description = &#34;AWS public IP address for tunnel 1&#34;
  value       = aws_vpn_connection.vpn_connection.tunnel1_address
}

output &#34;tunnel2_inside_cidr&#34; {
  description = &#34;Inside CIDR block for tunnel 2&#34;
  value       = aws_vpn_connection.vpn_connection.tunnel2_inside_cidr
}

output &#34;tunnel2_aws_bgp_ip&#34; {
  description = &#34;AWS BGP peer IP for tunnel 2&#34;
  value       = aws_vpn_connection.vpn_connection.tunnel2_vgw_inside_address
}

output &#34;tunnel2_customer_bgp_ip&#34; {
  description = &#34;Customer gateway BGP peer IP for tunnel 2&#34;
  value       = aws_vpn_connection.vpn_connection.tunnel2_cgw_inside_address
}

output &#34;tunnel2_aws_public_ip&#34; {
  description = &#34;AWS public IP address for tunnel 2&#34;
  value       = aws_vpn_connection.vpn_connection.tunnel2_address
}

output &#34;tunnel1_preshared_key&#34; {
  description = &#34;Preshared key for tunnel 1&#34;
  value       = aws_vpn_connection.vpn_connection.tunnel1_preshared_key
  sensitive   = true
}

output &#34;tunnel2_preshared_key&#34; {
  description = &#34;Preshared key for tunnel 2&#34;
  value       = aws_vpn_connection.vpn_connection.tunnel2_preshared_key
  sensitive   = true
}
</code></pre><p>At this point, your Terraform configuration should have the following structure:</p>
<pre tabindex="0"><code>├── main.tf
├── outputs.tf
└── variables.tf
</code></pre><h2 id="initializing-the-terraform-configuration">Initializing the Terraform Configuration<a hidden class="anchor" aria-hidden="true" href="#initializing-the-terraform-configuration">#</a></h2>
<p>To initialize Terraform and download required providers:</p>
<pre tabindex="0"><code>terraform init
</code></pre><h2 id="planning-the-changes">Planning the changes<a hidden class="anchor" aria-hidden="true" href="#planning-the-changes">#</a></h2>
<p>To preview the changes that Terraform will apply, we will use the <code>terraform plan</code> command, setting all the variables.</p>
<pre tabindex="0"><code>terraform plan \
  -var=&#34;aws_profile=terraform-vpn&#34; \
  -var=&#34;aws_region=your_aws_region&#34; \
  -var=&#34;vpc_id=your_vpc_id&#34; \
  -var=&#34;vpn_peer_ip=your_on_prem_peer_public_ip&#34; \
  -var=&#34;bgp_asn=your_on_prem_bgp_asn&#34; \
  -var=&#34;vgw_name_tag=my-vpn-gateway&#34; \
  -var=&#34;cgw_name_tag=my-customer-gateway&#34; \
  -var=&#34;vpn_connection_name_tag=my-vpn-connection&#34; \
  -out=vpn_to_onprem
</code></pre><p>This command will generate a detailed execution plan, and the resulting changes will be saved in a file named <code>vpn_to_onprem</code>. Feel free to modify this file name as needed, depending on your preferences or environment.</p>
<h2 id="applying-the-changes">Applying the changes<a hidden class="anchor" aria-hidden="true" href="#applying-the-changes">#</a></h2>
<p>Apply the planned changes to provision the infrastructure based on the output file generated by terraform plan:</p>
<pre tabindex="0"><code>terraform apply &#34;vpn_to_onprem&#34;
</code></pre><p>Once the command finishes running, Terraform will display some of the outputs defined in the <code>outputs.tf</code> file. However, you&rsquo;ll notice that sensitive information, such as pre-shared keys (PSKs), is not shown directly in the output for security reasons.</p>
<h2 id="viewing-terraform-outputs">Viewing Terraform Outputs<a hidden class="anchor" aria-hidden="true" href="#viewing-terraform-outputs">#</a></h2>
<p>As mentioned above, the outputs defined in the <code>outputs.tf</code> file are automatically provided by Terraform and stored in the <code>terraform.tfstate</code> file. To view all outputs, including sensitive data, you have two options:</p>
<p><em><strong>Option 1</strong></em>: Use the JSON flag
You can retrieve all outputs in JSON format, which will include sensitive information without redaction:</p>
<pre tabindex="0"><code>terraform output -json
</code></pre><p><em><strong>Option 2</strong></em>: Manually Inspect the State File
Open the <code>terraform.tfstate</code> file and manually search for the sensitive data. This file contains the full configuration, including sensitive details like PSKs and IP addresses. Note that handling this file requires caution as it contains critical information.</p>
<h2 id="terraform-destroy">Terraform Destroy<a hidden class="anchor" aria-hidden="true" href="#terraform-destroy">#</a></h2>
<p>One of Terraform&rsquo;s key benefits is how easily changes can be reverted with the <code>terraform destroy</code> command.</p>
<p>To rever the changes we previously applied, the sintax is:</p>
<pre tabindex="0"><code>terraform destroy \
  -var=&#34;aws_profile=terraform-vpn&#34; \
  -var=&#34;aws_region=your_aws_region&#34; \
  -var=&#34;vpc_id=your_vpc_id&#34; \
  -var=&#34;vpn_peer_ip=your_on_prem_peer_public_ip&#34; \
  -var=&#34;bgp_asn=your_on_prem_bgp_asn&#34; \
  -var=&#34;vgw_name_tag=my-vpn-gateway&#34; \
  -var=&#34;cgw_name_tag=my-customer-gateway&#34; \
  -var=&#34;vpn_connection_name_tag=my-vpn-connection&#34; \
</code></pre><h1 id="configuring-an-on-prem-cisco-router">Configuring an on-prem Cisco Router<a hidden class="anchor" aria-hidden="true" href="#configuring-an-on-prem-cisco-router">#</a></h1>
<p>To wrap up, below is an example configuration script for a Cisco router. This script will establish the VPN tunnels to AWS and configure the necessary settings for BGP over IPsec.</p>
<p>In this example, I&rsquo;m setting up only one of the VPN tunnels (AWS will create two for redundancy). To complete the configuration, simply replicate these settings using the information provided for the second tunnel.</p>
<p><em><strong>Some key points to remember:</strong></em></p>
<ul>
<li>AWS uses by default BGP ASN of 64512.</li>
<li>When configuring BGP over an IPsec VPN connection on AWS, by default, AWS assigns two inside IP addresses per tunnel from a private IP range for each of the two tunnels that are created for high availability.</li>
</ul>
<pre tabindex="0"><code>crypto isakmp policy 1
 encryption aes 128
 authentication pre-share
  group 2
  lifetime 28800
  hash sha

crypto keyring aws_vpn_keyring1
 pre-shared-key address &lt;aws tunnel 1 public ip&gt; key &lt;psk for tunnel 1&gt;

crypto isakmp profile aws_vpn_isakmp_profile1
  match identity address &lt;aws tunnel 1 public ip&gt;
  keyring aws_vpn_keyring1

crypto ipsec transform-set aws_vpn_tset esp-aes 128 esp-sha-hmac
 mode tunnel

crypto ipsec profile aws_vpn_ipsec_profile1
 set pfs group2
 set security-association lifetime seconds 3600
 set transform-set aws_vpn_tset

interface Tunnel1
 ip address &lt;tunnel 1 private ip&gt; 255.255.255.252
 ip tcp adjust-mss 1360
 ip virtual-reassembly
 tunnel source &lt;your tunnel source ip/interface&gt;
 tunnel destination &lt;aws tunnel 1 public ip&gt;
 tunnel mode ipsec ipv4
 tunnel protection ipsec profile aws_vpn_ipsec_profile1
 no shutdown
 exit

router bgp 65000
  neighbor &lt;aws tunnel 1 private ip&gt; remote-as 64512
  neighbor &lt;aws tunnel 1 private ip&gt; activate
  neighbor &lt;aws tunnel 1 private ip&gt; timers 10 30 30
  address-family ipv4 unicast
    neighbor &lt;aws tunnel 1 private ip&gt; remote-as 64512
    neighbor &lt;aws tunnel 1 private ip&gt; timers 10 30 30
    neighbor &lt;aws tunnel 1 private ip&gt; activate
    neighbor &lt;aws tunnel 1 private ip&gt; soft-reconfiguration inbound
</code></pre>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://localhost:1313/">Guilherme Lyra</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
